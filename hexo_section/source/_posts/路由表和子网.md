---
title: 路由表和子网
categories:
  - MyDefaultCategory
toc: false
date: 2018-09-25 18:39:26
tags:
---
子网掩码、子网、广播地址、路由表、相关。

<!-- more -->

* 子网掩码  
将某个IP地址划分成网络地址和主机地址两部分。左侧是网络地址，右侧是主机地址。

* 广播地址  
主机标识段全为1的IP地址。

* 例子 网络号&主机号&广播地址
例如，我的主机地址: 168.33.1.19, 子网掩码: 255.255.255.240, 那么：
```
                                             网段vv主机
255.255.255.240 => 11111111.11111111.11111111.11110000  (子网掩码)
168.033.001.019 => 10101000.00100001.00000001.00010011  (主机地址)
                                                 ^^
168.033.001.016 <= 10101000.00100001.00000001.00010000   网络号
              3 <=                                0011   主机号
168.033.001.031 <= 10101000.00100001.00000001.00011111   子网的广播地址
```
那么，在( 168.033.001.016 , 168.033.001.031 )开区间的任一个IP都可以充当网关的IP地址。  

* 路由表的工作逻辑  
逻辑一(易于理解)：
```c++
isSend = false
for( 路由表.筛选(不是`默认路由`的所有项) ) {
    if( 目标IP & Genmask == Destination ) {
        通过`Iface`发送数据给`Gateway`
        isSend = true
    }
}
if ( !isSend ) {
    通过`默认路由`发送数据
}
```
逻辑二(推荐编码)：
```c++
for( 路由表.排序(让`默认路由`最后被遍历) ) {
    if( 目标IP & Genmask == Destination ) {
        通过`Iface`发送数据给`Gateway`
        break
    }
}
```

* 默认路由  
Destination(Destination)和Genmask(网络掩码)都是`0.0.0.0`的那一条路由。它是一条特殊的静态路由。

* 例子 路由表  
例如，我的主机IP: 168.33.1.19, 子网掩码: 255.255.255.240, 我想发送数据到目标IP: 168.33.1.20, 路由表如下所示：
```
Destination                       Genmask                         Iface    Gateway
0.0.0.0                           0.0.0.0                         eno1     168.33.1.29
168.33.1.16                       255.255.255.240                 eno1     0.0.0.0
168.45.1.16                       255.255.255.240                 eno1     168.33.1.30
172.39.36.0                       255.255.255.0                   eno2     172.39.192.1
169.254.0.0                       255.255.0.0                     eno3     0.0.0.0
```
逐行判断( 目标IP & Genmask == Destination )的过程如下所示：
```
Destination                       Genmask                         Iface    Gateway
0.0.0.0                           0.0.0.0                         eno1     168.33.1.29
      已经发送,不再计算
168.33.1.16                       255.255.255.240                 eno1     0.0.0.0
      发送<=相等<=(168.33.1.16)<=( 255.255.255.240 & 168.33.1.20 )
168.45.1.16                       255.255.255.240                 eno1     168.33.1.30
      跳过<=不等<=(168.33.1.16)<=( 255.255.255.240 & 168.33.1.20 )
172.39.36.0                       255.255.255.0                   eno2     172.39.192.1
      跳过<=不等<=(168.33.1.0 )<=( 255.255.255.0   & 168.33.1.20 )
169.254.0.0                       255.255.0.0                     eno3     0.0.0.0
      跳过<=不等<=(168.33.0.0 )<=( 255.255.0.0     & 168.33.1.20 )
```
